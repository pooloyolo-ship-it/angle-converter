
<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="format-detection" content="telephone=no" />
<title>TS水準測量（器高式）計算 – 公開版</title>
<link rel="manifest" href="./manifest.webmanifest" />
<style>
  :root{--bg:#ffffff;--card:#fafafa;--ink:#111827;--muted:#6b7280;--accent:#2563eb;--border:#e5e7eb;--sticky-left:0px}
  *{box-sizing:border-box}
  body{margin:0;background:#ffffff;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  h1{font-size:clamp(1.2rem,2.5vw,1.6rem);font-weight:800;letter-spacing:0.02em}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 4px 16px rgba(0,0,0,.06);padding:18px;margin:14px 0}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .col{flex:1 1 240px}
  label{display:block;font-size:.95rem;color:var(--muted);margin-bottom:6px}
  input[type="number"], input[type="text"], select{width:100%;background:#ffffff;border:1px solid var(--border);color:var(--ink);padding:12px;border-radius:10px;outline:none;font-size:16px}
  .btn{appearance:none;border:1px solid #c7d2fe;background:#e0e7ff;color:#111827;padding:10px 14px;border-radius:10px;cursor:pointer;font-size:16px}
  .btn:hover{filter:brightness(1.05)}
  .btn.primary{background:#2563eb;border-color:#2563eb;color:#fff}
  .btn.ghost{background:transparent;border-color:#c7d2fe}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  .tbl-in, .tbl-out{table-layout:fixed}
  :root{
    --w-idx: clamp(32px, 6vw, 44px);
    --w-type: clamp(96px, 22vw, 140px);
    --w-dh: clamp(160px, 34vw, 260px);
    --w-memo: clamp(90px, 20vw, 130px);
    --w-del: clamp(48px, 10vw, 64px);
    --w-inrow: clamp(132px, 28vw, 180px);
    --w-gh: clamp(120px, 26vw, 160px);
  }
  th,td{text-align:left;padding:10px 10px}
  thead th{font-size:.9rem;color:#6b7280;background:#ffffff;position:sticky;top:0;z-index:2}
  tbody tr{background:#ffffff;border:1px solid var(--border)}
  tbody tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
  tbody tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
  .tag{display:inline-block;background:#eef2ff;border:1px solid #c7d2fe;color:#2563eb;padding:4px 8px;border-radius:999px;font-size:.8rem}
  .footer{font-size:.85rem;color:#6b7280}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  .grid > *{grid-column:span 12}
  @media (min-width:900px){.grid .span6{grid-column:span 6}}
  .pulse{animation:pulseBg 1.5s ease-out 1}
  @keyframes pulseBg{0%{background:#eef2ff}30%{background:#dbeafe}100%{background:#ffffff}}
  .table-wrap{overflow:auto}
  .sticky-name{position:sticky;left:var(--sticky-left);z-index:1;background:#ffffff}
  @media (max-width: 420px){
    :root{
      --w-type: clamp(96px, 24vw, 136px);
      --w-dh: clamp(150px, 40vw, 240px);
      --w-memo: clamp(84px, 18vw, 120px);
      --w-inrow: clamp(120px, 34vw, 170px);
    }
    th,td{padding:8px 8px}
    input[type="number"], input[type="text"], select{padding:10px}
  }
  tbody input, tbody select, tbody button{position:relative; z-index:3}
</style>
</head>
<body>
<div class="wrap">
  <h1>TS水準測量（器高式）計算 – 公開版</h1>
  <div class="card">
    <div class="row">
      <div class="col">
        <label>ベンチマーク標高（BM GH, m）</label>
        <input id="bmGH" type="number" step="0.001" inputmode="decimal" pattern="[-+0-9.]*" autocomplete="off" />
      </div>
    </div>
    <div class="row"><label><input id="autoInvert" type="checkbox" checked />TSの高低差の符号を自動で器高式用（＋↔−）に反転</label></div>
    <div class="row" style="gap:8px">
      <button class="btn primary" id="addRow">行を追加</button>
      <button class="btn ghost" id="example">例を入れる</button>
      <button class="btn ghost" id="clear">クリア</button>
      <span style="width:8px"></span>
      <button class="btn" id="calc">計算する</button>
      <button class="btn" id="exportCsv">CSV出力</button>
      <button class="btn" id="share">共有リンク</button>
    </div>
  </div>

  <div class="card">
    <div class="tag">入力：TS表示の高低差（1行目=B.S@BM、以降=F.S@測点。途中B.S可=ターン/TP）</div>
    <div class="table-wrap">
      <table class="tbl-in">
        <colgroup>
          <col style="width:var(--w-idx)">
          <col style="width:var(--w-type)">
          <col style="width:var(--w-dh)">
          <col style="width:var(--w-memo)">
          <col style="width:var(--w-del)">
        </colgroup>
        <thead>
          <tr>
            <th>#</th>
            <th>種別</th>
            <th>高低差 ΔH（TS表示, m）</th>
            <th class="sticky-name">Point/Note</th>
            <th>Del</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <div class="grid">
    <div class="card span6">
      <h3>結果（器高式）</h3>
      <div class="row">
        <div class="col">
          <label>器械高 I.H (m)</label>
          <input id="ihOut" type="text" readonly />
        </div>
      </div>
      <div class="table-wrap">
        <table class="tbl-out">
          <colgroup>
            <col style="width:var(--w-idx)">
            <col style="width:var(--w-inrow)">
            <col>
            <col style="width:var(--w-gh)">
          </colgroup>
          <thead>
            <tr><th>#</th><th>入力行</th><th class="sticky-name">測点名</th><th>計算GH (m)</th></tr>
          </thead>
          <tbody id="outBody"></tbody>
        </table>
      </div>
    </div>

    <div class="card span6">
      <h3>メモ（公開条件）</h3>
      <p class="footer">
        ・ターゲット高（プリズム等）は<strong>一定</strong>を前提。<br>
        ・T.P（途中B.S）対応。直前のF.Sで得たGHを新BMとしてI.H再計算。<br>
        ・CSVは<strong>英数字</strong>ヘッダー＆UTF-8 BOM付与でExcel文字化け対策。<br>
      </p>
    </div>
  </div>

  <p class="footer">© 2025 TS Leveling – Public</p>
</div>

<script src="./app.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    try { navigator.serviceWorker.register('./service-worker.js'); } catch(e) { console.warn(e); }
  }
</script>
</body>
</html>
